import{e as a,m as y,s as v,o as C,c as k,f as o,w as g,i as m,t as h,F as O,k as f,l as S}from"./index-327f84dd.js";const T={class:"space-x-6"},V={class:"flex space-x-6"},B=o("div",null,"服务器配置",-1),D=o("div",null,"提交信息",-1),E={id:"outgoing",class:"border-2 border-#000 min-h-17"},j=o("div",{class:"flex space-x-6"},[o("video",{src:"",id:"localVideo",class:"w-500px",autoplay:"",controls:""}),o("video",{id:"remoteVideo",src:"",class:"w-500px",autoplay:"",controls:""})],-1),R={__name:"test",setup(I){const d=()=>{S("wss://safana-neom-hcso.api.emotechlab.com/nc1render9/")},c=a(""),r=a({});a({});let n=null,l=[];window.addEventListener("onmessageWS",t=>{try{let e=JSON.parse(t.detail.data);e.type=="config"&&(c.value=JSON.stringify(e.peerConnectionOptions),console.log("The account password:",c.value),setTimeout(()=>{b(e.peerConnectionOptions)},3e3)),e.type=="offer"&&(r.value=e,setTimeout(()=>{x()},3e3)),e.type=="iceCandidate"&&l.push(e.candidate)}catch{}});let i=null;a(!1);const b=t=>{t=y(t),console.log("config",t),n=new RTCPeerConnection(t),i&&i.getTracks().forEach(e=>{n.addTrack(e,i)}),n.onconnectionstatechange=e=>{console.log("连接状态：",n.connectionState),n.connectionState=="connected"&&p()},n.onicecandidate=e=>{console.log("onicecandidate",e),e.candidate!==null&&v({type:"iceCandidate",candidate:e.candidate})},console.log("初始化完成",n),n.ontrack=e=>{if(console.log("track",e),e.track.kind==="video"){const s=document.getElementById("remoteVideo");s.srcObject=e.streams[0]}}},u=a(""),w=a(""),_=()=>{console.log("发送输入框内容")},p=async()=>{window.navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t=>{console.log("stream",t.getTracks()),i=t;var e=document.getElementById("localVideo");"srcObject"in e&&(e.srcObject=t,e.play()),d()})},x=async()=>{await n.setRemoteDescription(r.value);const t=await n.createAnswer();console.log("answer@@",t),await n.setLocalDescription(t),v(t);for(let e=0;e<l.length;e++)await n.addIceCandidate(l[e])};return(t,e)=>(C(),k(O,null,[o("div",T,[o("button",{onClick:e[0]||(e[0]=s=>d()),class:"p-4 bg-blue"},"Connect Socket"),o("button",{onClick:e[1]||(e[1]=s=>p()),class:"p-4 bg-blue"},"Open Camera")]),o("div",null,[o("div",V,[o("div",null,[B,g(o("textarea",{class:"border-2 border-#000 w-500px h-200px","onUpdate:modelValue":e[2]||(e[2]=s=>c.value=s)},null,512),[[m,c.value]])]),o("div",null,[D,g(o("textarea",{class:"border-2 border-#000 w-500px h-200px","onUpdate:modelValue":e[3]||(e[3]=s=>u.value=s)},null,512),[[m,u.value]])]),o("button",{class:"p-4 bg-blue",onClick:_},"submit")]),o("pre",E,h(w.value),1),j])],64))}};typeof f=="function"&&f(R);export{R as default};
